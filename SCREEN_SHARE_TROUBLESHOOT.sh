#!/bin/bash

echo "üñ•Ô∏è SCREEN SHARING TROUBLESHOOTING GUIDE"
echo "======================================"
echo ""

echo "üîç STEP 1: Test Browser Screen Sharing"
echo "---------------------------------------"
echo "1. Open http://localhost:3000 in your browser"
echo "2. Press F12 to open developer console"
echo "3. Copy and paste this script into console:"
echo ""
echo "fetch('/Volumes/Development/livekit/livekit-agent/livekit_screen_debug.js')"
echo "  .then(r => r.text())"
echo "  .then(code => eval(code));"
echo ""

echo "üîç STEP 2: Check Console Errors"
echo "------------------------------"
echo "Look for these specific errors:"
echo "‚Ä¢ NotAllowedError: Permission denied"
echo "‚Ä¢ NotReadableError: Source already in use"
echo "‚Ä¢ Permission denied: canPublish = false"
echo ""

echo "üîç STEP 3: Verify Browser Settings"
echo "---------------------------------"
echo "Chrome: chrome://settings/content/screenshare"
echo "Firefox: about:preferences#privacy"
echo "Safari: Safari > Preferences > Websites > Screen Sharing"
echo ""

echo "üîç STEP 4: Common Issues & Solutions"
echo "------------------------------------"
echo ""
echo "‚ùå 'Permission denied':"
echo "   ‚Ä¢ Click 'Allow' when browser prompts"
echo "   ‚Ä¢ Check browser screen sharing settings"
echo "   ‚Ä¢ Try refreshing the page"
echo ""
echo "‚ùå 'Source already in use':"
echo "   ‚Ä¢ Close other screen sharing apps"
echo "   ‚Ä¢ Restart browser"
echo "   ‚Ä¢ Try sharing a different window/tab"
echo ""
echo "‚ùå 'No screen share tracks found':"
echo "   ‚Ä¢ This means permission was granted but track failed"
echo "   ‚Ä¢ Check if agent can receive screen tracks"
echo "   ‚Ä¢ May need to restart the session"
echo ""

echo "üîç STEP 5: Test with Different Content"
echo "--------------------------------------"
echo "Try sharing different things:"
echo "‚Ä¢ Entire screen"
echo "‚Ä¢ Application window"
echo "‚Ä¢ Browser tab"
echo "‚Ä¢ Different browser window"
echo ""

echo "üîß DEBUG INFO:"
echo "-------------"
echo "Agent is running in: LiveKit Cloud (dev mode)"
echo "Frontend URL: http://localhost:3000"
echo "Room: security-plus-room"
echo "Permissions: canPublish = true ‚úÖ"
echo ""

echo "üìû If still not working:"
echo "‚Ä¢ Run the debug script above"
echo "‚Ä¢ Check browser console for specific errors"
echo "‚Ä¢ Try a different browser (Chrome recommended)"
echo ""

echo "üéØ Start with Step 1 and follow the debugging output!"
